# Web安全

## XSS

`XSS` 全称是 `Cross Site Scripting`(即`跨站脚本`)

### 反射型

恶意脚本作为**网络请求**的一部分，攻击者构造出特殊的URL，网站服务端在拿到请求后将恶意代码从URL中取出，然后将内容返回给浏览器，浏览器接收到响应后解析执行

比如

```
http://sanyuan.com?q=<script>alert("你完蛋了")</script>
```

这样，在服务器端会拿到`q`参数,然后将内容返回给浏览器端，浏览器将这些内容作为HTML的一部分解析，发现是一个脚本，直接执行，这样就被攻击了。

### 存储型

存储型的 XSS 将脚本存储到了服务端的数据库，然后在客户端执行这些脚本，从而达到攻击的效果。

常见的场景是留言评论区提交一段脚本代码，如果前后端没有做好转义的工作，那评论内容存到了数据库，在页面渲染过程中`直接执行`, 相当于执行一段未知逻辑的 JS 代码，是非常恐怖的

### 文档型

文档型的 XSS 攻击并不会经过服务端，而是作为中间人的角色，在数据传输过程劫持到网络数据包，然后**修改里面的 html 文档**！

这样的劫持方式包括`WIFI路由器劫持`或者`本地恶意软件`等。

### 如何防范

**不要相信用户的输入**

对url参数进行转码，做好转义工作，

**利用CSP**

CSP，即浏览器中的内容安全策略，它的核心思想就是服务器决定浏览器加载哪些资源，具体来说可以完成以下功能:

1. 限制其他域下的资源加载。
2. 禁止向其它域提交数据。
3. 提供上报机制，能帮助我们及时发现 XSS 攻击。

#### 利用 HttpOnly

很多 XSS 攻击脚本都是用来窃取Cookie, 而设置 Cookie 的 HttpOnly 属性后，JavaScript 便无法读取 Cookie 的值。这样也能很好的防范 XSS 攻击。

**对输入内容进行限制**

如不能包含特殊字符、对输入长度进行限制，因为XSS攻击原理就是**让恶意脚本直接在浏览器执行**增加XSS攻击难度

## CSRF

`CSRF(Cross-site request forgery)`, 即跨站请求伪造

诱导受害者进入第三方网站，在第三方网站中，向被攻击网站发送跨站请求。利用用户**目前的登录状态**发起跨站请求，绕过后台的用户验证，达到冒充用户对被攻击的网站执行某项操作的目的

### 特点

- 攻击通常在第三方网站上发起
  - 自动发送get请求
  - 自动发送post请求
  - 诱导用户点击发送get请求
- 利用受害者在被攻击网站上的登录凭证，**冒充**受害者提交操作。并不会去获取cookie信息

### 防范措施

1. 添加验证码

   会降低用户体验

2. 判断请求来源，检测Referer

   并不安全，Referer可以被更改

3. 设置Cookid的SameSite

   **a.** 在`Strict`模式下，浏览器完全禁止第三方请求携带Cookie。比如请求`sanyuan.com`网站只能在`sanyuan.com`域名当中请求才能携带 Cookie，在其他网站请求都不能。

   **b.** 在`Lax`模式，就宽松一点了，但是只能在 `get 方法提交表单`况或者`a 标签发送 get 请求`的情况下可以携带 Cookie，其他情况均不能。

   **c.** 在`None`模式下，也就是默认模式，请求会自动携带上 Cookie。

4. CSRF Token

   - 服务端给用户生成一个token，加密后传递给用户 

   - 用户在提交请求时，需要携带这个token 
   - 服务端验证token是否正确

## 点击劫持

1. 攻击者构建了一个非常有吸引力的网页【不知道哪些内容对你们来说有吸引力，我就不写页面了，偷个懒】
2. 将被攻击的页面放置在当前页面的 `iframe` 中
3. 使用样式将 iframe 叠加到非常有吸引力内容的上方
4. 将iframe设置为100%透明
5. 你被诱导点击了网页内容，你以为你点击的是***，而实际上，你成功被攻击了。

